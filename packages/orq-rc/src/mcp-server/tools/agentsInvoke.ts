/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import * as z from "zod/v3";
import { agentsInvoke } from "../../funcs/agentsInvoke.js";
import * as operations from "../../models/operations/index.js";
import { formatResult, ToolDefinition } from "../tools.js";

const args = {
  key: z.string(),
  requestBody: operations.InvokeAgentRequestBody$inboundSchema.optional(),
};

export const tool$agentsInvoke: ToolDefinition<typeof args> = {
  name: "agents-invoke",
  description: `Execute an agent task

Invokes an agent to perform a task with the provided input message. The agent will process the request using its configured model and tools, maintaining context through memory stores if configured. Supports automatic model fallback on primary model failure, tool execution, knowledge base retrieval, and continuation of previous conversations. Returns a task response that can be used to track execution status and retrieve results.`,
  args,
  tool: async (client, args, ctx) => {
    const [result, apiCall] = await agentsInvoke(
      client,
      args.key,
      args.requestBody,
      { fetchOptions: { signal: ctx.signal } },
    ).$inspect();

    if (!result.ok) {
      return {
        content: [{ type: "text", text: result.error.message }],
        isError: true,
      };
    }

    const value = result.value;

    return formatResult(value, apiCall);
  },
};
