/*
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

import * as z from "zod/v3";
import { remap as remap$ } from "../../lib/primitives.js";
import { safeParse } from "../../lib/schemas.js";
import { ClosedEnum } from "../../types/enums.js";
import { Result as SafeParseResult } from "../../types/fp.js";
import { SDKValidationError } from "../errors/sdkvalidationerror.js";

/**
 * The reason why the agent stopped generating
 */
export const ResponseDoneEventFinishReason = {
  Stop: "stop",
  Length: "length",
  ToolCalls: "tool_calls",
  ContentFilter: "content_filter",
  FunctionCall: "function_call",
  MaxIterations: "max_iterations",
  MaxTime: "max_time",
} as const;
/**
 * The reason why the agent stopped generating
 */
export type ResponseDoneEventFinishReason = ClosedEnum<
  typeof ResponseDoneEventFinishReason
>;

export type ResponseDoneEventPromptTokensDetails = {
  cachedTokens?: number | null | undefined;
  cacheCreationTokens?: number | null | undefined;
  /**
   * The number of audio input tokens consumed by the request.
   */
  audioTokens?: number | null | undefined;
};

export type ResponseDoneEventCompletionTokensDetails = {
  reasoningTokens?: number | null | undefined;
  acceptedPredictionTokens?: number | null | undefined;
  rejectedPredictionTokens?: number | null | undefined;
  /**
   * The number of audio output tokens produced by the response.
   */
  audioTokens?: number | null | undefined;
};

/**
 * Token usage statistics for the complete response
 */
export type ResponseDoneEventUsage = {
  /**
   * Number of tokens in the generated completion.
   */
  completionTokens?: number | undefined;
  /**
   * Number of tokens in the prompt.
   */
  promptTokens?: number | undefined;
  /**
   * Total number of tokens used in the request (prompt + completion).
   */
  totalTokens?: number | undefined;
  promptTokensDetails?: ResponseDoneEventPromptTokensDetails | null | undefined;
  completionTokensDetails?:
    | ResponseDoneEventCompletionTokensDetails
    | null
    | undefined;
};

export const ResponseDoneEventDataType = {
  Function: "function",
} as const;
export type ResponseDoneEventDataType = ClosedEnum<
  typeof ResponseDoneEventDataType
>;

export type ResponseDoneEventFunction = {
  /**
   * The name of the function to call
   */
  name?: string | undefined;
  /**
   * The arguments to pass to the function as JSON string
   */
  arguments?: string | undefined;
};

export type ResponseDoneEventPendingToolCalls = {
  /**
   * Unique identifier for the tool call
   */
  id: string;
  type: ResponseDoneEventDataType;
  function: ResponseDoneEventFunction;
};

export type ResponseDoneEventData = {
  /**
   * The reason why the agent stopped generating
   */
  finishReason: ResponseDoneEventFinishReason;
  /**
   * Token usage statistics for the complete response
   */
  usage?: ResponseDoneEventUsage | undefined;
  /**
   * Tool calls awaiting user response (when finishReason is function_call)
   */
  pendingToolCalls?: Array<ResponseDoneEventPendingToolCalls> | undefined;
};

/**
 * Emitted when the agent completes processing. Contains the finish reason and usage statistics.
 */
export type ResponseDoneEvent = {
  type: "response.done";
  /**
   * ISO timestamp of when the event occurred
   */
  timestamp: string;
  data: ResponseDoneEventData;
};

/** @internal */
export const ResponseDoneEventFinishReason$inboundSchema: z.ZodNativeEnum<
  typeof ResponseDoneEventFinishReason
> = z.nativeEnum(ResponseDoneEventFinishReason);

/** @internal */
export const ResponseDoneEventPromptTokensDetails$inboundSchema: z.ZodType<
  ResponseDoneEventPromptTokensDetails,
  z.ZodTypeDef,
  unknown
> = z.object({
  cached_tokens: z.nullable(z.number().int()).optional(),
  cache_creation_tokens: z.nullable(z.number().int()).optional(),
  audio_tokens: z.nullable(z.number().int()).optional(),
}).transform((v) => {
  return remap$(v, {
    "cached_tokens": "cachedTokens",
    "cache_creation_tokens": "cacheCreationTokens",
    "audio_tokens": "audioTokens",
  });
});

export function responseDoneEventPromptTokensDetailsFromJSON(
  jsonString: string,
): SafeParseResult<ResponseDoneEventPromptTokensDetails, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) =>
      ResponseDoneEventPromptTokensDetails$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'ResponseDoneEventPromptTokensDetails' from JSON`,
  );
}

/** @internal */
export const ResponseDoneEventCompletionTokensDetails$inboundSchema: z.ZodType<
  ResponseDoneEventCompletionTokensDetails,
  z.ZodTypeDef,
  unknown
> = z.object({
  reasoning_tokens: z.nullable(z.number()).optional(),
  accepted_prediction_tokens: z.nullable(z.number()).optional(),
  rejected_prediction_tokens: z.nullable(z.number()).optional(),
  audio_tokens: z.nullable(z.number().int()).optional(),
}).transform((v) => {
  return remap$(v, {
    "reasoning_tokens": "reasoningTokens",
    "accepted_prediction_tokens": "acceptedPredictionTokens",
    "rejected_prediction_tokens": "rejectedPredictionTokens",
    "audio_tokens": "audioTokens",
  });
});

export function responseDoneEventCompletionTokensDetailsFromJSON(
  jsonString: string,
): SafeParseResult<
  ResponseDoneEventCompletionTokensDetails,
  SDKValidationError
> {
  return safeParse(
    jsonString,
    (x) =>
      ResponseDoneEventCompletionTokensDetails$inboundSchema.parse(
        JSON.parse(x),
      ),
    `Failed to parse 'ResponseDoneEventCompletionTokensDetails' from JSON`,
  );
}

/** @internal */
export const ResponseDoneEventUsage$inboundSchema: z.ZodType<
  ResponseDoneEventUsage,
  z.ZodTypeDef,
  unknown
> = z.object({
  completion_tokens: z.number().optional(),
  prompt_tokens: z.number().optional(),
  total_tokens: z.number().optional(),
  prompt_tokens_details: z.nullable(
    z.lazy(() => ResponseDoneEventPromptTokensDetails$inboundSchema),
  ).optional(),
  completion_tokens_details: z.nullable(
    z.lazy(() => ResponseDoneEventCompletionTokensDetails$inboundSchema),
  ).optional(),
}).transform((v) => {
  return remap$(v, {
    "completion_tokens": "completionTokens",
    "prompt_tokens": "promptTokens",
    "total_tokens": "totalTokens",
    "prompt_tokens_details": "promptTokensDetails",
    "completion_tokens_details": "completionTokensDetails",
  });
});

export function responseDoneEventUsageFromJSON(
  jsonString: string,
): SafeParseResult<ResponseDoneEventUsage, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => ResponseDoneEventUsage$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'ResponseDoneEventUsage' from JSON`,
  );
}

/** @internal */
export const ResponseDoneEventDataType$inboundSchema: z.ZodNativeEnum<
  typeof ResponseDoneEventDataType
> = z.nativeEnum(ResponseDoneEventDataType);

/** @internal */
export const ResponseDoneEventFunction$inboundSchema: z.ZodType<
  ResponseDoneEventFunction,
  z.ZodTypeDef,
  unknown
> = z.object({
  name: z.string().optional(),
  arguments: z.string().optional(),
});

export function responseDoneEventFunctionFromJSON(
  jsonString: string,
): SafeParseResult<ResponseDoneEventFunction, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => ResponseDoneEventFunction$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'ResponseDoneEventFunction' from JSON`,
  );
}

/** @internal */
export const ResponseDoneEventPendingToolCalls$inboundSchema: z.ZodType<
  ResponseDoneEventPendingToolCalls,
  z.ZodTypeDef,
  unknown
> = z.object({
  id: z.string(),
  type: ResponseDoneEventDataType$inboundSchema,
  function: z.lazy(() => ResponseDoneEventFunction$inboundSchema),
});

export function responseDoneEventPendingToolCallsFromJSON(
  jsonString: string,
): SafeParseResult<ResponseDoneEventPendingToolCalls, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => ResponseDoneEventPendingToolCalls$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'ResponseDoneEventPendingToolCalls' from JSON`,
  );
}

/** @internal */
export const ResponseDoneEventData$inboundSchema: z.ZodType<
  ResponseDoneEventData,
  z.ZodTypeDef,
  unknown
> = z.object({
  finishReason: ResponseDoneEventFinishReason$inboundSchema,
  usage: z.lazy(() => ResponseDoneEventUsage$inboundSchema).optional(),
  pendingToolCalls: z.array(
    z.lazy(() => ResponseDoneEventPendingToolCalls$inboundSchema),
  ).optional(),
});

export function responseDoneEventDataFromJSON(
  jsonString: string,
): SafeParseResult<ResponseDoneEventData, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => ResponseDoneEventData$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'ResponseDoneEventData' from JSON`,
  );
}

/** @internal */
export const ResponseDoneEvent$inboundSchema: z.ZodType<
  ResponseDoneEvent,
  z.ZodTypeDef,
  unknown
> = z.object({
  type: z.literal("response.done"),
  timestamp: z.string(),
  data: z.lazy(() => ResponseDoneEventData$inboundSchema),
});

export function responseDoneEventFromJSON(
  jsonString: string,
): SafeParseResult<ResponseDoneEvent, SDKValidationError> {
  return safeParse(
    jsonString,
    (x) => ResponseDoneEvent$inboundSchema.parse(JSON.parse(x)),
    `Failed to parse 'ResponseDoneEvent' from JSON`,
  );
}
